<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Inference at Scale: Orchestration & Optimization</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Chosen Palette: Warm Neutral / Engineering Clean -->
    <!-- Primary Background: Slate-50/100 (Warm Grey) -->
    <!-- Card Background: White -->
    <!-- Text: Slate-800 -->
    <!-- Accents: Indigo-600 (Action), Emerald-600 (Success), Amber-500 (Warning) -->

    <!-- Application Structure Plan: 
         1. Hero/Executive Summary: Immediate context setting on the "Inference Crisis" (Cost/Latency).
         2. The Orchestration Layer: Interactive comparison of K8s vs. Ray vs. Bare Metal.
         3. Optimization Engine: A "Lab" section where users can play with variables (Batching, Quantization) to understand throughput.
         4. Architectural Patterns: Visualizing the "Best Practice" stack (Gateway -> Mesh -> Model).
         5. The Giants' Playbook: Case study cards summarizing approaches by Meta, OpenAI, etc.
         Rationale: This structure moves from high-level infrastructure choices down to specific optimization techniques, ending with industry examples.
    -->

    <!-- Visualization & Content Choices:
         1. "Orchestration Efficiency" Bubble Chart: Compare K8s, Nomad, Ray on Complexity vs. Flexibility.
         2. "Throughput Simulator" Line Chart: Dynamic chart showing the impact of Continuous Batching vs. Static Batching.
         3. "Latency Waterfall" Bar Chart: Breakdown of where time is actually spent (Network vs. Compute vs. Queue).
         4. Interactive Architecture Grid: HTML/CSS grid to show the request flow.
         NO SVG. NO Mermaid. All rendered via Chart.js or Tailwind Grid.
    -->

    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* Slate 50 */
            color: #1e293b; /* Slate 800 */
        }
        
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            height: 350px;
            max-height: 400px;
        }

        /* Custom Scrollbar for side panels if needed */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f5f9; 
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8; 
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(8px);
            border: 1px solid #e2e8f0;
        }

        .nav-active {
            border-bottom: 2px solid #4f46e5;
            color: #4f46e5;
            font-weight: 600;
        }
    </style>
</head>
<body class="antialiased min-h-screen flex flex-col">

    <!-- Navigation -->
    <nav class="sticky top-0 z-50 bg-white border-b border-slate-200 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <span class="text-xl font-bold text-slate-900 tracking-tight"><i class="fas fa-network-wired text-indigo-600 mr-2"></i>Inference<span class="text-indigo-600">Ops</span></span>
                </div>
                <div class="hidden sm:flex space-x-8 items-center" id="nav-container">
                    <!-- Nav items injected by JS -->
                </div>
                <div class="flex items-center sm:hidden">
                    <button id="mobile-menu-btn" class="text-slate-600 hover:text-slate-900 focus:outline-none">
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                </div>
            </div>
        </div>
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden sm:hidden bg-white border-t border-slate-100 p-4">
            <!-- Mobile items injected JS -->
        </div>
    </nav>

    <!-- Main Content Area -->
    <main class="flex-grow">
        
        <!-- Section 1: Hero & Executive Summary -->
        <section id="executive-summary" class="pt-12 pb-16 px-4 sm:px-6 lg:px-8 max-w-7xl mx-auto">
            <div class="text-center mb-12">
                <h1 class="text-4xl sm:text-5xl font-extrabold text-slate-900 mb-4">The State of AI Inference Orchestration</h1>
                <p class="text-lg text-slate-600 max-w-3xl mx-auto">
                    How tech giants optimize the "Last Mile" of AI. A synthesis of infrastructure patterns, from Kubernetes orchestration to kernel-level optimization.
                </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
                <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 hover:shadow-md transition-shadow">
                    <div class="text-indigo-600 mb-3"><i class="fas fa-layer-group text-2xl"></i></div>
                    <h3 class="font-semibold text-lg mb-2">The Hybrid Standard</h3>
                    <p class="text-sm text-slate-600">Kubernetes (K8s) is the undisputed substrate, but rarely used raw. Giants layer <strong>Ray Serve</strong> or custom control planes (like KServe) on top to handle Pythonic complexities.</p>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 hover:shadow-md transition-shadow">
                    <div class="text-emerald-600 mb-3"><i class="fas fa-tachometer-alt text-2xl"></i></div>
                    <h3 class="font-semibold text-lg mb-2">Throughput over Latency</h3>
                    <p class="text-sm text-slate-600">The shift from "Request/Response" to <strong>Continuous Batching</strong> and PagedAttention (vLLM) has increased GPU utilization by 4-10x compared to naive deployments.</p>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 hover:shadow-md transition-shadow">
                    <div class="text-amber-500 mb-3"><i class="fas fa-microchip text-2xl"></i></div>
                    <h3 class="font-semibold text-lg mb-2">Hardware Heterogeneity</h3>
                    <p class="text-sm text-slate-600">Orchestration now requires "topology awareness." Scheduling isn't just about CPU/RAM, but specific GPU interconnects (NVLink) and localized KV Caching.</p>
                </div>
            </div>
        </section>

        <!-- Section 2: Orchestration Layer (Interactive) -->
        <section id="orchestration" class="bg-slate-100 py-16">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="mb-10">
                    <h2 class="text-3xl font-bold text-slate-900 mb-4">1. The Orchestration Layer</h2>
                    <p class="text-slate-600 max-w-4xl">
                        While Kubernetes is the industry standard for container orchestration, AI inference introduces unique challenges: massive container images (20GB+), long startup times, and hardware accelerator requirements. Here is how the ecosystem solves this.
                    </p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Text Content / Interactive Selector -->
                    <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6">
                        <h3 class="text-xl font-bold mb-6">Orchestrator Comparison</h3>
                        <div class="space-y-4">
                            <button class="orch-btn w-full text-left p-4 rounded-lg border border-slate-200 hover:bg-indigo-50 hover:border-indigo-200 transition-colors active-orch" data-target="k8s">
                                <div class="flex justify-between items-center">
                                    <span class="font-semibold">Kubernetes (Raw + KServe)</span>
                                    <span class="text-xs bg-slate-200 px-2 py-1 rounded">Industry Standard</span>
                                </div>
                                <p class="text-sm text-slate-500 mt-1">The bedrock. High complexity, but maximum control over networking and hardware resources.</p>
                            </button>
                            <button class="orch-btn w-full text-left p-4 rounded-lg border border-slate-200 hover:bg-indigo-50 hover:border-indigo-200 transition-colors" data-target="ray">
                                <div class="flex justify-between items-center">
                                    <span class="font-semibold">Ray Serve</span>
                                    <span class="text-xs bg-emerald-100 text-emerald-700 px-2 py-1 rounded">Rising Star</span>
                                </div>
                                <p class="text-sm text-slate-500 mt-1">Python-first. Handles "Actor" lifecycle better than K8s. Best for composition (chaining models).</p>
                            </button>
                            <button class="orch-btn w-full text-left p-4 rounded-lg border border-slate-200 hover:bg-indigo-50 hover:border-indigo-200 transition-colors" data-target="serverless">
                                <div class="flex justify-between items-center">
                                    <span class="font-semibold">Serverless (Knative/Lambda)</span>
                                    <span class="text-xs bg-amber-100 text-amber-700 px-2 py-1 rounded">Niche</span>
                                </div>
                                <p class="text-sm text-slate-500 mt-1">Great for scale-to-zero, but suffers from "Cold Start" (loading 50GB weights takes time).</p>
                            </button>
                        </div>
                        
                        <div id="orch-details" class="mt-6 p-4 bg-slate-50 rounded-lg border border-slate-200 text-sm">
                            <!-- Dynamic Content Loaded Here -->
                        </div>
                    </div>

                    <!-- Chart Column -->
                    <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6 flex flex-col">
                        <h3 class="text-xl font-bold mb-2">Complexity vs. Scalability</h3>
                        <p class="text-sm text-slate-500 mb-6">Visualizing the trade-off between operational overhead and ability to handle massive scale.</p>
                        <div class="chart-container flex-grow">
                            <canvas id="orchChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 3: The Optimization Lab (Simulation) -->
        <section id="optimization" class="py-16 bg-white">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="mb-10">
                    <h2 class="text-3xl font-bold text-slate-900 mb-4">2. The Optimization Lab</h2>
                    <p class="text-slate-600 max-w-4xl">
                        Orchestration just keeps the servers running. <strong>Optimization</strong> is what makes the economics work. Giants utilize <strong>Continuous Batching</strong> and <strong>Quantization</strong> to saturate GPUs. Use the simulator below to see how these techniques affect throughput.
                    </p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- Controls -->
                    <div class="lg:col-span-1 bg-slate-50 p-6 rounded-xl border border-slate-200">
                        <h4 class="font-bold text-slate-800 mb-6"><i class="fas fa-sliders-h mr-2"></i>Configure Inference</h4>
                        
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-slate-700 mb-2">Batching Strategy</label>
                            <select id="sim-strategy" class="w-full bg-white border border-slate-300 rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                <option value="static">Static Batching (Standard)</option>
                                <option value="continuous">Continuous Batching (Orca/vLLM)</option>
                            </select>
                            <p class="text-xs text-slate-500 mt-2" id="strategy-desc">Waits for batch to fill or timeout. Inefficient for variable lengths.</p>
                        </div>

                        <div class="mb-6">
                            <label class="block text-sm font-medium text-slate-700 mb-2">Quantization Level</label>
                            <div class="flex space-x-2">
                                <button class="quant-btn flex-1 py-2 px-4 rounded border border-slate-300 bg-white hover:bg-slate-100 active-quant" data-val="fp16">FP16</button>
                                <button class="quant-btn flex-1 py-2 px-4 rounded border border-slate-300 bg-white hover:bg-slate-100" data-val="int8">INT8</button>
                                <button class="quant-btn flex-1 py-2 px-4 rounded border border-slate-300 bg-white hover:bg-slate-100" data-val="fp4">FP4</button>
                            </div>
                        </div>

                        <div class="mb-6">
                            <label class="block text-sm font-medium text-slate-700 mb-2">Concurrent User Requests</label>
                            <input type="range" id="sim-users" min="10" max="500" value="50" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer">
                            <div class="flex justify-between text-xs text-slate-500 mt-1">
                                <span>10 Users</span>
                                <span id="user-count-display">50 Users</span>
                                <span>500 Users</span>
                            </div>
                        </div>
                    </div>

                    <!-- Simulator Output -->
                    <div class="lg:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Metric Cards -->
                        <div class="bg-indigo-50 p-6 rounded-xl border border-indigo-100 flex flex-col justify-center items-center text-center">
                            <span class="text-indigo-800 text-sm font-semibold uppercase tracking-wider mb-2">Estimated Throughput</span>
                            <div class="text-4xl font-extrabold text-indigo-900 mb-1" id="metric-throughput">0</div>
                            <span class="text-indigo-600 text-sm">Tokens / Sec</span>
                        </div>
                        <div class="bg-slate-50 p-6 rounded-xl border border-slate-200 flex flex-col justify-center items-center text-center">
                            <span class="text-slate-800 text-sm font-semibold uppercase tracking-wider mb-2">P95 Latency</span>
                            <div class="text-4xl font-extrabold text-slate-900 mb-1" id="metric-latency">0</div>
                            <span class="text-slate-600 text-sm">Milliseconds / Token</span>
                        </div>

                        <!-- Real-time Chart -->
                        <div class="col-span-1 md:col-span-2 bg-white p-4 rounded-xl border border-slate-200 shadow-sm">
                            <div class="chart-container" style="height: 250px;">
                                <canvas id="simChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 4: Patterns & Best Practices -->
        <section id="patterns" class="bg-slate-100 py-16">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="mb-10">
                    <h2 class="text-3xl font-bold text-slate-900 mb-4">3. Patterns & Best Practices</h2>
                    <p class="text-slate-600 max-w-4xl">
                        How do the giants wire it all together? It's not just a model in a container. It is a complex pipeline involving sidecars, gateways, and predictive scaling.
                    </p>
                </div>

                <!-- Patterns Grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    
                    <!-- Pattern 1 -->
                    <div class="bg-white p-6 rounded-lg shadow-sm border border-slate-200">
                        <div class="h-10 w-10 bg-blue-100 rounded-full flex items-center justify-center text-blue-600 mb-4">
                            <i class="fas fa-project-diagram"></i>
                        </div>
                        <h3 class="font-bold text-lg mb-2">The Sidecar Pattern</h3>
                        <p class="text-sm text-slate-600 mb-4">Don't put networking logic in the model container. Use a sidecar (like <strong>Envoy</strong> or Dapr) to handle request routing, mTLS, and metrics logging. This keeps the model server lightweight (just Python/C++).</p>
                        <div class="bg-slate-50 p-3 rounded text-xs font-mono border border-slate-200">
                            [Pod]<br>
                            ├── [Container: vLLM Engine]<br>
                            └── [Container: Envoy Sidecar] <--- Traffic
                        </div>
                    </div>

                    <!-- Pattern 2 -->
                    <div class="bg-white p-6 rounded-lg shadow-sm border border-slate-200">
                        <div class="h-10 w-10 bg-purple-100 rounded-full flex items-center justify-center text-purple-600 mb-4">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <h3 class="font-bold text-lg mb-2">Predictive Scaling (KEDA)</h3>
                        <p class="text-sm text-slate-600 mb-4">Standard HPA (CPU-based scaling) is too slow for AI. Giants use event-driven scalers (KEDA) monitoring <strong>Queue Depth</strong> or <strong>GPU Duty Cycle</strong> to scale up <em>before</em> latency spikes.</p>
                        <div class="bg-slate-50 p-3 rounded text-xs font-mono border border-slate-200">
                            Trigger: Prometheus Query<br>
                            metric: avg_queue_size > 5<br>
                            action: scale_replicas +2
                        </div>
                    </div>

                    <!-- Pattern 3 -->
                    <div class="bg-white p-6 rounded-lg shadow-sm border border-slate-200">
                        <div class="h-10 w-10 bg-teal-100 rounded-full flex items-center justify-center text-teal-600 mb-4">
                            <i class="fas fa-memory"></i>
                        </div>
                        <h3 class="font-bold text-lg mb-2">KV Cache Separation</h3>
                        <p class="text-sm text-slate-600 mb-4">For long-context LLMs, the KV cache (memory of conversation) is massive. Advanced architectures disaggregate <strong>Prefill</strong> (Compute heavy) from <strong>Decode</strong> (Memory heavy) instances.</p>
                        <div class="bg-slate-50 p-3 rounded text-xs font-mono border border-slate-200">
                            User -> [Prefill Cluster] -> KV Transfer -> [Decode Cluster]
                        </div>
                    </div>

                </div>
            </div>
        </section>

        <!-- Section 5: The Decision Matrix -->
        <section id="decision-matrix" class="py-16 bg-white border-t border-slate-200">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
                <h2 class="text-3xl font-bold text-slate-900 mb-8">Summary: What should you use?</h2>
                
                <div class="overflow-x-auto">
                    <table class="min-w-full text-left text-sm whitespace-nowrap">
                        <thead class="uppercase tracking-wider border-b-2 border-slate-200 bg-slate-50 text-slate-500 font-semibold">
                            <tr>
                                <th scope="col" class="px-6 py-4">Scale Stage</th>
                                <th scope="col" class="px-6 py-4">Recommended Stack</th>
                                <th scope="col" class="px-6 py-4">Primary Optimization</th>
                                <th scope="col" class="px-6 py-4">Orchestrator</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-slate-100">
                            <tr class="hover:bg-slate-50 transition-colors">
                                <td class="px-6 py-4 font-bold text-slate-700">Startup / MVP</td>
                                <td class="px-6 py-4">Managed Serverless (Bedrock/OpenAI/Replicate)</td>
                                <td class="px-6 py-4 text-slate-500">None (Vendor managed)</td>
                                <td class="px-6 py-4"><span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">None</span></td>
                            </tr>
                            <tr class="hover:bg-slate-50 transition-colors">
                                <td class="px-6 py-4 font-bold text-slate-700">Mid-Market (Production)</td>
                                <td class="px-6 py-4">K8s (EKS/GKE) + Ray Serve</td>
                                <td class="px-6 py-4 text-slate-500">Quantization (INT8), Dynamic Batching</td>
                                <td class="px-6 py-4"><span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-indigo-100 text-indigo-800">Kubernetes</span></td>
                            </tr>
                            <tr class="hover:bg-slate-50 transition-colors">
                                <td class="px-6 py-4 font-bold text-slate-700">AI Giant (Meta/Uber)</td>
                                <td class="px-6 py-4">Bare Metal K8s + Custom Kernels (Triton/vLLM)</td>
                                <td class="px-6 py-4 text-slate-500">Speculative Decoding, PagedAttention, Custom Silicon</td>
                                <td class="px-6 py-4"><span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-emerald-100 text-emerald-800">Custom K8s</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

    </main>

    <footer class="bg-slate-900 text-slate-400 py-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 grid grid-cols-1 md:grid-cols-2 gap-8">
            <div>
                <span class="text-white font-bold text-lg">InferenceOps Research</span>
                <p class="mt-2 text-sm">Synthesized analysis of AI Infrastructure patterns as of 2025.</p>
            </div>
            <div class="text-right">
                <p class="text-xs">Generated by AI • No SVG Graphics • Tailwind CSS • Chart.js</p>
            </div>
        </div>
    </footer>

    <!-- Application Logic -->
    <script>
        // --- DATA STORE & STATE ---
        const state = {
            currentTab: 'k8s',
            sim: {
                strategy: 'static',
                quantization: 'fp16',
                users: 50
            }
        };

        const contentData = {
            k8s: {
                title: "Kubernetes (K8s) + KServe",
                body: "Kubernetes is the de-facto operating system for the cloud. For AI, it provides the necessary abstraction over GPUs (via device plugins). However, native K8s deployments (Deployment object) are ill-suited for AI because they don't understand 'Model Loading' vs 'Server Healthy'. <br><br><strong>Best Practice:</strong> Use <strong>KServe</strong>. It adds a 'InferenceService' CRD that abstracts the complexity of server spin-up, model downloading, and request routing.",
                pros: ["Standardization", "Ecosystem support", "Granular hardware control"],
                cons: ["Steep learning curve", "YAML hell", "Complex networking"]
            },
            ray: {
                title: "Ray Serve",
                body: "Ray has emerged as the strongest challenger/complement to K8s. Ray Serve is a scalable model serving library built on Ray. Unlike K8s, which manages containers, Ray manages 'Actors' (Python classes). This allows for incredibly fast scaling and complex pipelines (e.g., A/B testing models in Python code, not YAML config).<br><br><strong>Best Practice:</strong> Run Ray <em>inside</em> Kubernetes (KubeRay). Let K8s manage the machines, let Ray manage the Python workers.",
                pros: ["Python-native", "Fine-grained scaling", "Pipeline composition"],
                cons: ["Another layer of complexity", "JVM-like resource heaviness"]
            },
            serverless: {
                title: "Serverless (Knative/Lambda)",
                body: "True serverless is difficult for LLMs due to 'Cold Starts'. Loading a 70B parameter model takes minutes. However, for smaller models or sporadic workloads, Knative (Serving based on K8s) allows 'Scale-to-Zero'. <br><br><strong>Best Practice:</strong> Use for non-latency-sensitive batch jobs or small BERT-sized models.",
                pros: ["Cost efficiency (Scale to Zero)", "No ops management"],
                cons: ["Cold starts", "GPU limitations", "Memory limits"]
            }
        };

        // --- NAVIGATION LOGIC ---
        const navItems = [
            { id: 'executive-summary', label: 'Overview' },
            { id: 'orchestration', label: 'Orchestration' },
            { id: 'optimization', label: 'Optimization Lab' },
            { id: 'patterns', label: 'Patterns' }
        ];

        function initNav() {
            const container = document.getElementById('nav-container');
            const mobileContainer = document.getElementById('mobile-menu');
            
            navItems.forEach(item => {
                // Desktop
                const link = document.createElement('a');
                link.href = `#${item.id}`;
                link.textContent = item.label;
                link.className = "text-slate-600 hover:text-indigo-600 px-3 py-2 rounded-md text-sm font-medium transition-colors";
                container.appendChild(link);

                // Mobile
                const mLink = document.createElement('a');
                mLink.href = `#${item.id}`;
                mLink.textContent = item.label;
                mLink.className = "block px-3 py-2 rounded-md text-base font-medium text-slate-700 hover:text-indigo-600 hover:bg-slate-50";
                mobileContainer.appendChild(mLink);
            });

            // Mobile Toggle
            document.getElementById('mobile-menu-btn').addEventListener('click', () => {
                mobileContainer.classList.toggle('hidden');
            });
        }

        // --- ORCHESTRATION INTERACTION ---
        function initOrchestration() {
            const buttons = document.querySelectorAll('.orch-btn');
            const detailsContainer = document.getElementById('orch-details');

            function updateDetails(key) {
                const data = contentData[key];
                detailsContainer.innerHTML = `
                    <h4 class="font-bold text-slate-800 mb-2">${data.title}</h4>
                    <p class="mb-4 text-slate-600 leading-relaxed">${data.body}</p>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <span class="text-xs font-bold text-emerald-600 uppercase">Pros</span>
                            <ul class="list-disc list-inside text-slate-600 mt-1">
                                ${data.pros.map(p => `<li>${p}</li>`).join('')}
                            </ul>
                        </div>
                        <div>
                            <span class="text-xs font-bold text-rose-600 uppercase">Cons</span>
                            <ul class="list-disc list-inside text-slate-600 mt-1">
                                ${data.cons.map(c => `<li>${c}</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                `;
            }

            buttons.forEach(btn => {
                btn.addEventListener('click', () => {
                    // UI Update
                    buttons.forEach(b => {
                        b.classList.remove('bg-indigo-50', 'border-indigo-200', 'ring-1', 'ring-indigo-200');
                        b.classList.add('border-slate-200');
                    });
                    btn.classList.add('bg-indigo-50', 'border-indigo-200', 'ring-1', 'ring-indigo-200');
                    btn.classList.remove('border-slate-200');
                    
                    // Content Update
                    updateDetails(btn.dataset.target);
                });
            });

            // Init default
            updateDetails('k8s');
            buttons[0].classList.add('bg-indigo-50', 'border-indigo-200', 'ring-1', 'ring-indigo-200');
        }

        // --- CHARTS INITIALIZATION ---
        function initCharts() {
            // Chart 1: Orchestration Bubble Chart
            const ctxOrch = document.getElementById('orchChart').getContext('2d');
            new Chart(ctxOrch, {
                type: 'bubble',
                data: {
                    datasets: [
                        { label: 'Kubernetes', data: [{x: 9, y: 9, r: 20}], backgroundColor: '#6366f1' }, // Indigo
                        { label: 'Ray Serve', data: [{x: 7, y: 8, r: 15}], backgroundColor: '#10b981' }, // Emerald
                        { label: 'Serverless', data: [{x: 3, y: 4, r: 10}], backgroundColor: '#f59e0b' }, // Amber
                        { label: 'Bare Metal', data: [{x: 10, y: 6, r: 8}], backgroundColor: '#64748b' }  // Slate
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { 
                            title: { display: true, text: 'Operational Complexity (Low -> High)' },
                            min: 0, max: 12
                        },
                        y: { 
                            title: { display: true, text: 'Flexibility & Scale (Low -> High)' },
                            min: 0, max: 12
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: (context) => context.raw.label || context.dataset.label
                            }
                        }
                    }
                }
            });

            // Chart 2: Simulator Chart (Line)
            const ctxSim = document.getElementById('simChart').getContext('2d');
            window.simChartInstance = new Chart(ctxSim, {
                type: 'bar',
                data: {
                    labels: ['Throughput (Tokens/s)', 'Efficiency Score'],
                    datasets: [{
                        label: 'Current Configuration',
                        data: [0, 0],
                        backgroundColor: ['#4f46e5', '#818cf8'],
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    scales: {
                        x: { beginAtZero: true }
                    }
                }
            });
        }

        // --- SIMULATOR LOGIC ---
        function initSimulator() {
            const strategySelect = document.getElementById('sim-strategy');
            const quantBtns = document.querySelectorAll('.quant-btn');
            const userSlider = document.getElementById('sim-users');
            const userDisplay = document.getElementById('user-count-display');
            const desc = document.getElementById('strategy-desc');
            const metricThroughput = document.getElementById('metric-throughput');
            const metricLatency = document.getElementById('metric-latency');

            function calculateMetrics() {
                const users = parseInt(userSlider.value);
                const isContinuous = state.sim.strategy === 'continuous';
                const quant = state.sim.quantization;

                // Base Throughput (Tokens/sec) for a typical 70B model on A100
                let baseThroughput = 100; 

                // Quantization Multipliers
                // INT8 is approx 2x faster than FP16. FP4 is theoretical 3-4x.
                let quantMult = 1;
                if (quant === 'int8') quantMult = 1.8;
                if (quant === 'fp4') quantMult = 3.2;

                // Batching Multipliers
                // Static batching hits a wall. Continuous batching scales better with concurrency.
                let batchMult = 1;
                if (isContinuous) {
                    // Continuous batching handles high concurrency much better
                    batchMult = 1 + (users / 100); 
                } else {
                    // Static batching degrades after a certain point due to padding waste
                    batchMult = 1 + (Math.min(users, 50) / 100); 
                }

                const totalThroughput = Math.round(baseThroughput * quantMult * batchMult * (users/10));
                
                // Latency (ms per token)
                // Higher throughput usually means slightly higher latency per user due to queueing, 
                // but continuous batching minimizes this spike.
                let baseLatency = 40; // ms
                let queuePenalty = isContinuous ? (users * 0.1) : (users * 0.5);
                const p95Latency = Math.round((baseLatency / quantMult) + queuePenalty);

                // Update DOM
                metricThroughput.innerText = totalThroughput.toLocaleString();
                metricLatency.innerText = p95Latency;
                userDisplay.innerText = `${users} Users`;

                // Update Chart
                window.simChartInstance.data.datasets[0].data = [totalThroughput, (totalThroughput/p95Latency)*10];
                window.simChartInstance.update();
            }

            // Event Listeners
            strategySelect.addEventListener('change', (e) => {
                state.sim.strategy = e.target.value;
                desc.innerText = e.target.value === 'continuous' 
                    ? "Dynamic scheduling. Fills gaps in GPU memory instantly. 4x-10x throughput gain."
                    : "Waits for batch to fill or timeout. Inefficient for variable lengths due to padding.";
                calculateMetrics();
            });

            quantBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    quantBtns.forEach(b => {
                        b.classList.remove('bg-indigo-600', 'text-white', 'border-transparent', 'active-quant');
                        b.classList.add('bg-white', 'text-slate-900', 'border-slate-300');
                    });
                    btn.classList.remove('bg-white', 'text-slate-900', 'border-slate-300');
                    btn.classList.add('bg-indigo-600', 'text-white', 'border-transparent', 'active-quant');
                    state.sim.quantization = btn.dataset.val;
                    calculateMetrics();
                });
            });

            userSlider.addEventListener('input', () => {
                calculateMetrics();
            });

            // Initial Run
            calculateMetrics();
        }

        // --- MAIN ENTRY POINT ---
        document.addEventListener('DOMContentLoaded', () => {
            initNav();
            initCharts();
            initOrchestration();
            initSimulator();

            // Set initial state for quantization buttons
            const defaultQuant = document.querySelector('[data-val="fp16"]');
            if(defaultQuant) {
                defaultQuant.classList.remove('bg-white', 'border-slate-300');
                defaultQuant.classList.add('bg-indigo-600', 'text-white', 'border-transparent');
            }
        });

    </script>
</body>
</html>